<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="">
    <meta name="author" content="">

    <title>MSB Mastercard World Elite</title>

    <!-- CSS FILES -->
    <link rel="preconnect" href="https://fonts.googleapis.com">

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <link
        href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,200;0,400;0,600;0,700;1,200;1,700&display=swap"
        rel="stylesheet">

    <link href="css/bootstrap.min.css" rel="stylesheet">

    <link href="css/bootstrap-icons.css" rel="stylesheet">

    <link href="css/vegas.min.css" rel="stylesheet">

    <link href="css/tooplate-barista.css" rel="stylesheet">

</head>

<body>

    <main>
        <nav class="navbar navbar-expand-lg">
            <div class="container">
                <a class="navbar-brand d-flex align-items-center" href="index.html">
                    <img src="images/msb-logo1.png" class="navbar-brand-image img-fluid" alt="MSB Logo">
                    <span class="navbar-brand-text">MSB</span>
                </a>

                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-lg-auto">
                        <li class="nav-item">
                            <a class="nav-link click-scroll" href="#section_1">Trang chủ</a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link click-scroll" href="#section_2">Sản phẩm</a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link click-scroll" href="#section_3">Chương trình</a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link click-scroll" href="#section_4">Quy trình</a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link click-scroll" href="#section_5">Liên hệ</a>
                        </li>
                    </ul>

                    <div class="ms-lg-3">
                        <a class="btn custom-btn custom-border-btn" href="reservation.html">
                            Đăng ký
                            <i class="bi-arrow-up-right ms-2"></i>
                        </a>
                    </div>
                </div>
            </div>
        </nav>


        <section class="hero-section d-flex justify-content-center align-items-center" id="section_1">

            <div class="container">
                <div class="row align-items-center">

                    <div class="col-lg-6 col-12 mx-auto">
                        <div class="hero-content-wrapper">
                            <em class="hero-label">THẺ</em>
                            <h1 class="hero-title-main">MasterCard</h1>
                            <h1 class="hero-title-sub">World Elite</h1>
                            <p class="hero-slogan"><em>Đặc quyền thượng lưu tinh hoa dẫn lối</em></p>

                            <a class="btn custom-btn custom-border-btn smoothscroll me-3" href="#section_2">
                                Giới thiệu
                            </a>

                            <a class="btn custom-btn custom-border-btn1 smoothscroll me-3"
                                href="reservation.html"><strong>Đăng
                                    ký</strong></a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="hero-slides"></div>
        </section>


        <section class="about-section section-padding" id="section_2">
            <div class="section-overlay"></div>
            <div class="container">
                <div class="row align-items-center">

                    <div class="col-lg-6 col-12">
                        <div class="ratio ratio-16x9 custom-video-wrapper">
                            <video controls class="custom-video" poster="" style="border-radius: 12px;">
                                <source src="https://www.canva.com/design/DAGqsr7K9IM/WElvGiqOF2rwzcABe9AN9g/watch" type="video/mp4">
                            </video>
                        </div>
                    </div>

                    <div class="col-lg-5 col-12 mt-4 mt-lg-0 mx-auto">

                        <em class="text-white">Thẻ MasterCard</em>

                        <h2 class="text-white mb-3">World Elite</h2>

                        <p class="text-white4">
                            Dòng thẻ cao cấp nhất – chất liệu kim loại sang trọng,<br> biểu tượng vị thế dẫn đầu.
                        </p>

                        <p class="text-white4">
                            Đặc quyền VIP: sân bay, khách sạn, sân golf – mọi nơi bạn tới.
                        </p>

                        <p class="text-white4">
                            Trợ lý & cố vấn – đồng hành trên mọi hành trình thành công.
                        </p>

                        <a href="#barista-team" class="smoothscroll btn custom-btn custom-border-btn mt-3 mb-4">Đặc
                            quyền
                        </a>
                    </div>

                </div>
            </div>
        </section>


        <section class="barista-section section-padding section-bg" id="barista-team">
            <div class="container">
                <div class="row justify-content-center">

                    <div class="col-lg-12 col-12 text-center mb-4 pb-lg-2">
                        <em class="text-white">Đặc quyền</em>

                        <h2 class="text-white">Thượng lưu</h2>
                    </div>

                    <div class="col-lg-3 col-md-6 col-12 mb-4">
                        <a href="https://www.canva.com/design/DAGqIAUMkMc/JYNNxR50foRJ2jepCqY80g/view?utm_content=DAGqIAUMkMc&utm_campaign=designshare&utm_medium=link2&utm_source=uniquelinks&utlId=h2f1bafa352"
                            target="_blank" style="text-decoration: none;">
                            <div class="team-block-wrap">
                                <div class="team-block-info d-flex flex-column">
                                    <div class="d-flex mt-auto mb-3">
                                        <h4 class="text-white mb-0">Hoàn 10%</h4>
                                    </div>
                                    <p class="text-white mb-0">Du lịch, ẩm thực, thời trang cao cấp</p>
                                </div>
                                <div class="team-block-image-wrap">
                                    <img src="images/team/portrait-elegant-old-man-wearing-suit.jpg"
                                        class="team-block-image img-fluid" alt="">
                                </div>
                            </div>
                        </a>
                    </div>

                    <div class="col-lg-3 col-md-6 col-12 mb-4">
                        <div class="team-block-wrap">
                            <div class="team-block-info d-flex flex-column">
                                <div class="d-flex mt-auto mb-3">
                                    <h4 class="text-white mb-0">Không rào cản</h4>
                                </div>

                                <p class="text-white mb-0">Tặng 100% phí giao dịch ngoại tệ</p>
                            </div>

                            <div class="team-block-image-wrap">
                                <img src="images/team/cute-korean-barista-girl-pouring-coffee-prepare-filter-batch-brew-pour-working-cafe.jpg"
                                    class="team-block-image img-fluid" alt="">
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-3 col-md-6 col-12 mb-4">
                        <a href="https://www.canva.com/design/DAGqHeDLkPM/qu6C5R-f0Pe8S8l4cML9Mg/view?utm_content=DAGqHeDLkPM&utm_campaign=designshare&utm_medium=link2&utm_source=uniquelinks&utlId=hfe78f3f9bb"
                            target="_blank" style="text-decoration: none;">
                            <div class="team-block-wrap">
                                <div class="team-block-info d-flex flex-column">
                                    <div class="d-flex mt-auto mb-3">
                                        <h4 class="text-white mb-0">Đồng hành</h4>
                                    </div>

                                    <p class="text-white mb-0">Không giới hạn phòng chờ hạng thương gia toàn cầu</p>
                                </div>

                                <div class="team-block-image-wrap">
                                    <img src="images/team/small-business-owner-drinking-coffee.jpg"
                                        class="team-block-image img-fluid" alt="">
                                </div>
                            </div>
                        </a>
                    </div>

                    <div class="col-lg-3 col-md-6 col-12">
                        <a href="https://www.canva.com/design/DAGqIFIWT0A/sOQlQyvHtCmDRZOtaHY5og/view?utm_content=DAGqIFIWT0A&utm_campaign=designshare&utm_medium=link2&utm_source=uniquelinks&utlId=h0c371a0700"
                            target="_blank" style="text-decoration: none;">
                            <div class="team-block-wrap">
                                <div class="team-block-info d-flex flex-column">
                                    <div class="d-flex mt-auto mb-3">
                                        <h4 class="text-white mb-0">Ưu đãi</h4>
                                    </div>

                                    <p class="text-white mb-0">Bảo hiểm du lịch toàn cầu lên tới 11 tỷ đồng</p>
                                </div>

                                <div class="team-block-image-wrap">
                                    <img src="images/team/smiley-business-woman-working-cashier.jpg"
                                        class="team-block-image img-fluid" alt="">
                                </div>
                            </div>
                        </a>
                    </div>

                </div>
            </div>
        </section>


        <section class="menu-section section-padding" id="section_3">
            <div class="container">
                <div class="row">

                    <div class="col-lg-6 col-12 mb-4 mb-lg-0">
                        <div class="menu-block-wrap">
                            <div class="text-center mb-4 pb-lg-2">
                                <em class="text-white">Khách hàng</em>
                                <h4 class="text-yellow">High-Net-Worth</h4>
                            </div>

                            <div class="menu-block">
                                <div class="d-flex">
                                    <h6>Số dư</h6>

                                    <span class="underline"></span>

                                    <strong class="ms-auto">10 tỷ</strong>
                                </div>

                                <div class="border-top mt-2 pt-2">
                                    <small class="small-yellow">Bình quân 3 tháng gần nhất từ 10 tỷ VNĐ/tháng trở lên
                                        (bao gồm tiền gửi, tài khoản thanh toán, trái phiếu lưu ký)</small>
                                </div>
                            </div>

                            <div class="menu-block my-4">
                                <div class="d-flex">
                                    <h6>
                                        Thu nhập
                                    </h6>

                                    <span class="underline"></span>

                                    <strong class="ms-auto">100 triệu</strong>
                                </div>

                                <div class="border-top mt-2 pt-2">
                                    <small class="small-yellow">Lương chuyển khoản qua MSB từ 100 triệu VNĐ/tháng trở
                                        lên</small><br>
                                    <small class="small-yellow">Là lãnh đạo cấp cao tại cơ quan nhà nước cấp thành phố
                                        hoặc ngân hàng</small>
                                </div>
                            </div>

                            <div class="menu-block">
                                <div class="d-flex">
                                    <h6>Chủ doanh nghiệp</h6>

                                    <span class="underline"></span>

                                    <strong class="ms-auto">200- trên 1000 tỷ</strong>

                                </div>

                                <div class="border-top mt-2 pt-2">
                                    <small class="small-yellow">Doanh thu năm từ 200–500 tỷ và có quan hệ tài chính với
                                        MSB</small><br>
                                    <small class="small-yellow">Hoặc doanh thu từ 500–1.000 tỷ và thuộc top doanh nghiệp
                                        hàng đầu
                                        tỉnh/thành</small>
                                </div>
                            </div>

                            <div class="menu-block my-4">
                                <div class="d-flex">
                                    <h6>Đặc biệt</h6>

                                    <span class="underline"></span>

                                    <strong class="ms-auto">VIP</strong>
                                </div>

                                <div class="border-top mt-2 pt-2">
                                    <small class="small-yellow">Tổng giám đốc hoặc Chủ tịch HĐQT MSB giới thiệu</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-6 col-12">
                        <div class="menu-block-wrap">
                            <div class="text-center mb-4 pb-lg-2">
                                <em class="text-white">Checklist</em>
                                <h4 class="text-yellow">Đăng ký thẻ</h4>
                            </div>

                            <div class="menu-block">
                                <div class="d-flex">
                                    <h6>Độ tuổi</h6>

                                    <span class="underline"></span>

                                    <strong class="ms-auto">25-65</strong>
                                </div>

                                <div class="border-top mt-2 pt-2">
                                    <small class="small-yellow">Khách hàng từ 25 đến 65 tuổi</small><br>
                                    <small class="small-yellow"> </small><br> <!-- Dòng trống -->
                                </div>
                            </div>

                            <div class="menu-block my-4">
                                <div class="d-flex">
                                    <h6>
                                        Hạn mức
                                    </h6>

                                    <span class="underline"></span>

                                    <strong class="ms-auto">500 triệu - 2 tỷ</strong>
                                </div>

                                <div class="border-top mt-2 pt-2">
                                    <small class="small-yellow">Tối thiểu: 500 triệu đồng</small><br>
                                    <small class="small-yellow">Tối đa: 2 tỷ đồng</small>
                                </div>
                            </div>

                            <div class="menu-block my-4">
                                <div class="d-flex">
                                    <h6>Giấy tờ</h6>
                                    <span class="underline"></span>

                                    <strong class="ms-auto">Đơn giản</strong>
                                </div>

                                <div class="border-top mt-2 pt-2">
                                    <small class="small-yellow">Giấy tờ định danh còn hiệu lực</small><br>
                                    <small class="small-yellow">Thông tin nguồn thu</small><br>
                                    <small class="small-yellow">Thông tin người liên quan</small><br>
                                </div>
                            </div>

                            <div class="menu-block">
                                <div class="d-flex">
                                    <h6>Hồ sơ</h6>
                                    <span class="underline"></span>

                                    <strong class="ms-auto">Tối thiểu</strong>
                                </div>

                                <div class="border-top mt-2 pt-2">
                                    <small class="small-yellow">Đơn đề nghị phát hành thẻ</small><br>
                                    <small class="small-yellow"> </small><br> <!-- Dòng trống -->
                                </div>
                            </div>

                        </div>
                    </div>

                </div>
            </div>
        </section>

        <section class="reviews-section section-padding section-bg" id="section_4">
            <div class="container">
                <div class="row align-items-stretch">

                    <!-- Cột trái: Card -->
                    <div class="col-lg-6 col-12 d-flex">
                        <div class="step-carousel flex-fill d-flex flex-column">
                            <!-- Header không đổi -->
                            <div class="card-header">
                                <em>Quy trình</em>
                                <h2>Đăng kí thẻ</h2>
                            </div>

                            <!-- Nội dung chuyển động nằm trong wrapper riêng -->
                            <div class="step-content">
                                <div class="step-card">
                                    <h4>1. Liên hệ</h4>
                                    <ul>
                                        <li>Hotline: 1800 599 999</li>
                                        <li>Email: mfirst247@msb.com.vn</li>
                                        <li>Website: www.msb.com.vn</li>
                                    </ul>
                                </div>

                                <div class="step-card">
                                    <h4>2. Tiếp nhận</h4>
                                    <p>MSB sẽ tư vấn và hỗ trợ quý khách trong 2 giờ làm việc.</p>
                                </div>

                                <div class="step-card">
                                    <h4>3. Hồ sơ</h4>
                                    <ul>
                                        <li>Giấy tờ tùy thân còn hiệu lực</li>
                                        <li>Hồ sơ chứng minh thu nhập</li>
                                        <li>Đơn phát hành thẻ</li>
                                        <li>Thông tin bên liên quan (nếu có)</li>
                                    </ul>
                                </div>

                                <div class="step-card">
                                    <h4>4. Hoàn tất</h4>
                                    <ul>
                                        <li>Thẻ được in trong ngày và gửi đến Quý khách sớm nhất.</li>
                                    </ul>
                                </div>

                            </div>
                        </div>
                    </div>

                    <!-- Cột phải: Video -->
                    <div class="col-lg-6 col-12 d-flex">
                        <div class="custom-video-wrapper flex-fill">
                            <video controls class="custom-video"
                                style="border-radius: 12px; width: 100%; height: 100%; object-fit: cover;">
                                <source src="https://www.canva.com/design/DAGqsqHEDcM/LPcUONbrm2ko0ZL582PGAw/watch" type="video/mp4">
                            </video>
                        </div>
                    </div>

                </div>
            </div>
        </section>



        <section class="contact-section section-padding" id="section_5">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12 col-12 position-relative">
                        <h2 class="text-white mb-4 pb-lg-2">Liên hệ với chúng tôi</h2>
                    </div>

                    <div class="col-lg-6 col-12 position-relative">
                        <div class="contact-overlay"></div> <!-- 👈 Lớp nền đen -->
                        <form action="#" method="post" class="custom-form contact-form" role="form">
                            <div class="row">

                                <div class="col-lg-6 col-12">
                                    <label for="name" class="form-label">Name <sup class="text-danger">*</sup></label>

                                    <input type="text" name="name" id="name" class="form-control black-text-input"
                                        placeholder="Jackson" required="">
                                </div>

                                <div class="col-lg-6 col-12">
                                    <label for="email" class="form-label">Email Address</label>

                                    <input type="email" name="email" id="email" pattern="[^ @]*@[^ @]*"
                                        class="form-control" placeholder="Jack@gmail.com" required="">
                                </div>

                                <div class="col-12">
                                    <label for="message" class="form-label">How can we help?</label>

                                    <textarea name="message" rows="4" class="form-control" id="message"
                                        placeholder="Message" required=""></textarea>

                                </div>
                            </div>

                            <div class="col-lg-5 col-12 mx-auto mt-3">
                                <button type="submit" class="form-control">Send Message</button>
                            </div>
                        </form>
                    </div>
                    <!-- 
                            <div class="col-lg-6 col-12 mx-auto mt-5 mt-lg-0 ps-lg-5">
                                <iframe class="google-map" src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3724.233064525008!2d105.80674542519785!3d21.02335853796423!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3135ab689b1045cd%3A0x23804386ee1d8d5d!2zNTRBIE5ndXnhu4VuIENow60gVGhhbmgsIEzDoW5nIFRoxrDhu6NuZywgxJDhu5FuZyDEkGEsIEjDoCBO4buZaSwgVmnhu4d0IE5hbQ!5e0!3m2!1svi!2s!4v1749203442465!5m2!1svi!2s" width="100%" height="300" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>  
                            </div> -->

                </div>
            </div>
        </section>

        <footer class="site-footer">
            <div class="container">
                <div class="row">

                    <div class="col-lg-6 col-12 me-auto">
                        <em class="text-white d-block mb-4">Where to find us?</em>

                        <strong class="text-white">
                            <i class="text-white3"></i>
                            Trụ sở chính: 54A Nguyễn Chí Thanh, Đống Đa, Hà Nội
                        </strong>

                        <ul class="social-icon mt-4">
                            <li class="social-icon-item">
                                <a href="https://www.facebook.com/MSBVietnam" class="social-icon-link bi-facebook">
                                </a>
                            </li>

                            <li class="social-icon-item">
                                <a href="https://www.linkedin.com/company/msbcareer" target="_new"
                                    class="social-icon-link bi-linkedin">
                                </a>
                            </li>

                            <li class="social-icon-item">
                                <a href="https://www.youtube.com/@MSBVietnam/featured"
                                    class="social-icon-link bi-youtube">
                                </a>
                            </li>

                        </ul>
                    </div>

                    <div class="col-lg-5 col-12">
                        <em class="text-white d-block mb-4">Contact</em>

                        <p class="d-flex mb-1">
                        <div class="footer-hotline d-flex flex-column">
                            <div class="d-flex">
                                <strong class="me-2">Hotline:</strong>
                                <div>
                                    <a href="tel:1800599999" class="site-footer-link">
                                        Trong nước: 1800 599 999
                                    </a><br>
                                    <a href="tel:+842439445566" class="site-footer-link ms-0">
                                        Nước ngoài: +84 2439 445 566
                                    </a>
                                </div>
                            </div>
                        </div>
                        </p>

                        <p class="d-flex">
                            <strong class="me-2">Email:</strong>

                            <a href="mailto:mfirst247@msb.com.vn" class="site-footer-link">
                                mfirst247@msb.com.vn
                            </a>
                        </p>
                    </div>
                    
                    <div class="col-lg-8 col-12 mt-4">
                        <p class="copyright-text mb-0">Designed and Developed by Chuongnq3 - RDM</p>
                    </div>
        </footer>
    </main>

    <!-- Chatbot UI -->
    <!-- Nút mở chatbot (icon avatar) -->
    <div id="chatbot-toggle">
        <img src="images/icons8-ai-chatting-100.png" alt="Chatbot Icon">
    </div>

    <!-- Khung chatbot -->
    <div id="chatbot-container" class="hidden">
        <div id="chatbot-header">
            MSB – Hỗ trợ mọi lúc mọi nơi
            <span id="chatbot-close">×</span>
        </div>
        <div id="chatbot-messages"></div>
        <form id="chatbot-form">
            <input type="text" id="chatbot-input" placeholder="Nhập tin nhắn..." />
            <button type="submit" id="chatbot-send-btn">
                <img src="images/Send.png" alt="Gửi" />
            </button>
        </form>

    </div>

    <!-- JAVASCRIPT FILES -->
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.sticky.js"></script>
    <script src="js/click-scroll.js"></script>
    <script src="js/vegas.min.js"></script>
    <script src="js/custom.js"></script>
    <script src="js/marked.min.js"></script>

    <script>
        const cards = document.querySelectorAll(".step-card");
        let index = 0;

        function showNextCard() {
            const current = cards[index];
            index = (index + 1) % cards.length;
            const next = cards[index];

            cards.forEach(card => card.classList.remove("fly-in", "fly-out"));

            current.classList.add("fly-out");
            next.classList.add("fly-in");
        }

        // Hiển thị lần đầu
        cards[0].classList.add("fly-in");

        // Chuyển cảnh mỗi 4 giây
        setInterval(showNextCard, 4000);
    </script>


    <script>
        /* ———— CONFIG ———— */
        const assistant_id = "asst_ZRPcnjQrPo38gbph1YHXDknt"; // 🔁 Thay bằng assistant thật
        const file_ids = [
            "file-Qpo1C7bghFKXPC3P5EMDNC",
            "file-UBuhfJGuKz2FP5CGYVaxZ3",
            "file-2DhFpmmptFfSgQdeN7emuu",
            "file-4f7CKN8QDa2qrVWYWvsmqp"
        ];
        const apiKey = "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"; // 🔁 Thay bằng API key thật

        /* ———— STATE ———— */
        let thread_id = localStorage.getItem("thread_id") || null;

        /* ———— HELPERS ———— */
        function scrollMessages() {
            const m = document.getElementById("chatbot-messages");
            m.scrollTop = m.scrollHeight;
        }
        // function appendMessage(sender, rawText) {
        //     const wrap = document.createElement("div");
        //     wrap.className = `chat-message-wrapper ${sender === "AI" ? "bot" : "user"}`;

        //     // 1) Bỏ marker trích dẫn nếu không cần
        //     let html = rawText.replace(/【\d+:\d+†source】/g, "");

        //     // 2) Thay \n thành <br> để giữ xuống dòng
        //     html = html.replace(/\n/g, "<br>");

        //     wrap.innerHTML = `<div class="chat-message">${html}</div>`;

        //     console.log(wrap);
        //     document.getElementById("chatbot-messages").appendChild(wrap);
        //     scrollMessages();
        // }

        function appendMessage(sender, rawText) {
            const wrap = document.createElement("div");
            wrap.className = `chat-message-wrapper ${sender === "AI" ? "bot" : "user"}`;

            // 1. Xoá marker nguồn
            const cleaned = rawText.replace(/【\d+:\d+†source】/g, "");

            // 2. Thay \n bằng markdown-compatible xuống dòng
            const withLineBreak = cleaned.replace(/\n/g, '  \n');

            // 3. Dùng marked.parseInline để không sinh <p>
            let html;
            try {
                html = marked.parseInline(withLineBreak);

                // 4. Nếu Markdown vẫn không render xuống dòng, ép bằng <br>
                if (!html.includes('<br>')) {
                    html = html.replace(/\n/g, '<br>');
                }
            } catch (e) {
                html = cleaned.replace(/\n/g, "<br>");
            }

            // 5. Gắn vào chat
            wrap.innerHTML = `<div class="chat-message ${sender === "AI" ? "bot" : "user"}">${html}</div>`;
            document.getElementById("chatbot-messages").appendChild(wrap);
            scrollMessages();
        }


        function appendLoading() {
            const id = "loading-msg";
            const wrap = document.createElement("div");
            wrap.id = id; wrap.className = "chat-message-wrapper bot";
            wrap.innerHTML = `<div class="chat-message">Đang soạn…</div>`;
            document.getElementById("chatbot-messages").appendChild(wrap);
            scrollMessages();
        }

        /* ———— OPEN / CLOSE ———— */
        document.getElementById("chatbot-toggle").onclick = () => {
            document.getElementById("chatbot-container").style.display = "flex";
            document.getElementById("chatbot-toggle").style.display = "none";
            if (!document.querySelector(".bot")) appendMessage("AI", "Xin chào, mình là AI‑RDM! Mình có thể giúp gì cho bạn?");
        };
        document.getElementById("chatbot-close").onclick = () => {
            document.getElementById("chatbot-container").style.display = "none";
            document.getElementById("chatbot-toggle").style.display = "flex";
        };

        /* ———— MAIN SEND ———— */
        document.getElementById("chatbot-form").addEventListener("submit", async e => {
            e.preventDefault();
            const input = document.getElementById("chatbot-input");
            const text = input.value.trim();
            if (!text) return;
            appendMessage("user", text);
            input.value = "";
            appendLoading();
            const answer = await sendMessage(text);
            document.getElementById("loading-msg")?.remove();
            appendMessage("AI", answer);
        });

        async function sendMessage(userText) {
            try {
                /* 1️⃣  Nếu chưa có thread thì tạo mới */
                if (!thread_id) {
                    const res = await fetch("https://api.openai.com/v1/threads", {
                        method: "POST",
                        headers: { "Content-Type": "application/json", Authorization: `Bearer ${apiKey}`, "OpenAI-Beta": "assistants=v2" },
                        body: JSON.stringify({})
                    });
                    const data = await res.json();
                    thread_id = data.id;
                    localStorage.setItem("thread_id", thread_id);
                }

                /* 2️⃣  Tạo message — lần ĐẦU cần đính kèm file */
                const attachments = (!localStorage.getItem("sent_first")) ?
                    file_ids.map(id => ({ file_id: id, tools: [{ type: "file_search" }] })) : [];

                const msgRes = await fetch(`https://api.openai.com/v1/threads/${thread_id}/messages`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json", Authorization: `Bearer ${apiKey}`, "OpenAI-Beta": "assistants=v2" },
                    body: JSON.stringify({ role: "user", content: userText, attachments })
                });
                if (!localStorage.getItem("sent_first")) localStorage.setItem("sent_first", "1");

                /* 3️⃣  Tạo run */
                const runRes = await fetch(`https://api.openai.com/v1/threads/${thread_id}/runs`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json", Authorization: `Bearer ${apiKey}`, "OpenAI-Beta": "assistants=v2" },
                    body: JSON.stringify({ assistant_id, instructions: "Trả lời ngắn gọn, đúng số liệu, bằng tiếng Việt." })
                });
                const { id: run_id } = await runRes.json();

                /* 4️⃣  Poll tới khi xong */
                while (true) {
                    await new Promise(r => setTimeout(r, 1000));
                    const check = await fetch(`https://api.openai.com/v1/threads/${thread_id}/runs/${run_id}`, {
                        headers: { Authorization: `Bearer ${apiKey}`, "OpenAI-Beta": "assistants=v2" }
                    });
                    const { status } = await check.json();
                    if (status === "completed") break;
                    if (["failed", "cancelled"].includes(status)) throw new Error("Run failed: " + status);
                }

                /* 5️⃣  Lấy tin nhắn mới nhất của assistant */
                const msgList = await fetch(`https://api.openai.com/v1/threads/${thread_id}/messages?limit=1`, {
                    headers: { Authorization: `Bearer ${apiKey}`, "OpenAI-Beta": "assistants=v2" }
                });
                const { data } = await msgList.json();
                return data?.[0]?.content?.[0]?.text?.value || "Xin lỗi, mình chưa có thông tin.";
            } catch (err) {
                console.error(err);
                return "Đã xảy ra lỗi khi kết nối GPT.";
            }
        }

        // 🔁 Bấm ESC để đóng chat
        document.addEventListener("keydown", function (event) {
            if (event.key === "Escape") {
                const chatbot = document.getElementById("chatbot-container");
                const toggle = document.getElementById("chatbot-toggle");
                if (chatbot.style.display === "flex") {
                    chatbot.style.display = "none";
                    toggle.style.display = "flex";
                }
            }
        });

    </script>

</body>

</html>
